<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalyst Connector Builder</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%2306b6d4' d='M55 10 L30 50 L45 50 L40 90 L70 40 L55 40 Z'/%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --bg-card-hover: #1f2943;
            --border-color: #2d3a52;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-primary: #3b82f6;
            --accent-secondary: #2563eb;
            --accent-cyan: #06b6d4;
            --status-green: #10b981;
            --status-amber: #f59e0b;
            --status-red: #ef4444;
            --status-green-bg: rgba(16, 185, 129, 0.15);
            --status-amber-bg: rgba(245, 158, 11, 0.15);
            --status-red-bg: rgba(239, 68, 68, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: #0a0e27;
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Floating orbs background */
        .bg-orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.3;
            animation: float 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 400px;
            height: 400px;
            background: #3B82F6;
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 300px;
            height: 300px;
            background: #60A5FA;
            bottom: -50px;
            right: -50px;
            animation-delay: 5s;
        }

        .orb-3 {
            width: 250px;
            height: 250px;
            background: #2563EB;
            top: 20%;
            right: 10%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            50% {
                transform: translate(30px, -30px) scale(1.1);
            }
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo-icon-img {
            height: 63px;
            width: auto;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 0.05em;
        }

        .header-quick-launch {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .header-launch-btn {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
            position: relative;
        }

        .header-launch-btn svg,
        .header-launch-btn i {
            width: 16px;
            height: 16px;
            font-size: 16px;
        }

        .header-launch-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-cyan);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .header-launch-btn.dashboard:hover {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .header-launch-btn.n8n:hover {
            border-color: #ff6d5a;
            color: #ff6d5a;
        }

        .header-launch-btn.camunda:hover {
            border-color: #eab308;
            color: #eab308;
        }

        .header-launch-btn.builder:hover {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .header-launch-btn.connectors:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .header-launch-btn.github:hover {
            border-color: #8b5cf6;
            color: #8b5cf6;
        }

        .header-launch-btn.logs:hover {
            border-color: var(--status-green);
            color: var(--status-green);
        }

        /* Tooltip */
        .header-launch-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 8px;
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.75rem;
            white-space: pre-line;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-width: 150px;
        }

        .header-launch-btn:hover::after {
            opacity: 1;
            visibility: visible;
        }

        .header-status {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--status-green);
            box-shadow: 0 0 8px var(--status-green);
            animation: pulse 2s infinite;
        }

        .status-dot.warning {
            background: var(--status-amber);
            box-shadow: 0 0 8px var(--status-amber);
        }

        .status-dot.error {
            background: var(--status-red);
            box-shadow: 0 0 8px var(--status-red);
        }

        .status-dot.checking {
            background: var(--text-muted);
            box-shadow: none;
            animation: blink 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Particles canvas */
        #reactive-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* Ensure content is above orbs and particles */
        .header, .container {
            position: relative;
            z-index: 1;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            align-items: start;
        }

        .main-content {
            min-width: 0;
        }

        .steps {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .step {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .step.active {
            opacity: 1;
            border-color: var(--accent-cyan);
        }

        .step.completed {
            opacity: 1;
            border-color: var(--status-green);
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .step.active .step-number {
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
            color: white;
        }

        .step.completed .step-number {
            background: var(--status-green);
            border-color: var(--status-green);
            color: white;
        }

        .step-label {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-icon svg {
            width: 20px;
            height: 20px;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-zone:hover {
            border-color: var(--accent-cyan);
            background: rgba(6, 182, 212, 0.05);
        }

        .upload-zone.dragover {
            border-color: var(--accent-cyan);
            background: rgba(6, 182, 212, 0.1);
        }

        .upload-zone.has-file {
            border-color: var(--status-green);
            background: var(--status-green-bg);
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            color: var(--text-muted);
        }

        .upload-zone.has-file .upload-icon {
            color: var(--status-green);
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .file-info {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .upload-zone.has-file .file-info {
            display: block;
        }

        .file-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--status-green);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            transition: border-color 0.2s;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .preview-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .preview-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .preview-box {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
        }

        .preview-box-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .preview-list {
            list-style: none;
        }

        .preview-list li {
            padding: 0.375rem 0;
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .preview-list li::before {
            content: "";
            width: 6px;
            height: 6px;
            background: var(--accent-cyan);
            border-radius: 50%;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin: 0.25rem;
        }

        .tag.required {
            border-color: var(--status-amber);
            color: var(--status-amber);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'DM Sans', sans-serif;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
        }

        .btn-success {
            background: var(--status-green);
            color: white;
        }

        .btn-success:hover {
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .output-files {
            display: none;
        }

        .output-files.visible {
            display: block;
        }

        .file-list {
            list-style: none;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .file-item-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .file-item-icon {
            width: 32px;
            height: 32px;
            background: var(--bg-card);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-cyan);
        }

        .file-item-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
        }

        .file-item-size {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .alert {
            padding: 1rem 1.25rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .alert.success {
            background: var(--status-green-bg);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-left: 4px solid var(--status-green);
        }

        .alert.info {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 4px solid var(--accent-primary);
        }

        .alert-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .hidden {
            display: none;
        }

        /* Instructions Panel */
        .instructions-panel {
            position: sticky;
            top: 7rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            max-height: calc(100vh - 9rem);
            overflow-y: auto;
        }

        .instructions-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .instructions-icon {
            width: 36px;
            height: 36px;
            background: rgba(6, 182, 212, 0.15);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-cyan);
        }

        .instructions-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .instruction-section {
            margin-bottom: 1.5rem;
        }

        .instruction-section:last-child {
            margin-bottom: 0;
        }

        .instruction-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instruction-section-title::before {
            content: '';
            width: 4px;
            height: 4px;
            background: var(--accent-cyan);
            border-radius: 50%;
        }

        .instruction-content {
            font-size: 0.813rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .instruction-content ol,
        .instruction-content ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .instruction-content li {
            margin: 0.5rem 0;
        }

        .instruction-content code {
            background: var(--bg-secondary);
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--accent-cyan);
        }

        .instruction-content strong {
            color: var(--text-primary);
        }

        .instruction-note {
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--accent-primary);
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .instruction-note strong {
            color: var(--accent-primary);
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
            .instructions-panel {
                position: static;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .steps {
                flex-direction: column;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .preview-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Animated background orbs -->
    <div class="bg-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Animated particles canvas -->
    <canvas id="reactive-bg"></canvas>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="/images/catalyst-connector-logo.png" alt="Catalyst" class="logo-icon-img">
                <div>
                    <div class="logo-text">Catalyst Connector</div>
                    <div class="logo-subtitle">BUILDER</div>
                </div>
            </div>
            <div class="header-quick-launch">
                <a href="/" class="header-launch-btn dashboard" data-tooltip="Control Panel&#10;Main dashboard">
                    <i class="ph ph-house"></i>
                </a>
                <a href="#" class="header-launch-btn n8n" onclick="openN8n(); return false;" data-tooltip="n8n Workflows&#10;Build and manage automation workflows">
                    <i class="ph ph-flow-arrow"></i>
                    <span>n8n</span>
                </a>
                <a href="#" class="header-launch-btn camunda" onclick="openCamunda(); return false;" data-tooltip="Camunda Cockpit&#10;Monitor BPMN processes and tasks">
                    <i class="ph ph-squares-four"></i>
                    <span>Camunda</span>
                </a>
                <a href="/connectors.html" class="header-launch-btn connectors" data-tooltip="Connector Gallery&#10;Browse all available connectors">
                    <i class="ph ph-grid-four"></i>
                    <span>Connectors</span>
                </a>
                <a href="../connector-builder/" class="header-launch-btn builder" data-tooltip="Connector Builder&#10;Create connectors from n8n workflows">
                    <i class="ph ph-stack"></i>
                    <span>Builder</span>
                </a>
                <a href="https://github.com/AlainJaques22/catalyst-connector" target="_blank" class="header-launch-btn github" data-tooltip="GitHub Repository&#10;Source code and documentation">
                    <i class="ph ph-github-logo"></i>
                    <span>GitHub</span>
                </a>
                <a href="/logs.html" class="header-launch-btn logs" data-tooltip="Live Logs&#10;Full screen execution logs">
                    <i class="ph ph-list-bullets"></i>
                    <span>Logs</span>
                </a>
            </div>
            <div class="header-status">
                <div class="status-indicator">
                    <span class="status-dot checking" id="n8nStatus"></span>
                    <span>n8n</span>
                </div>
                <div class="status-indicator">
                    <span class="status-dot checking" id="camundaStatus"></span>
                    <span>Camunda</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
        <!-- Progress Steps -->
        <div class="steps">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div class="step-label">Upload Workflow</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-label">Configure</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-label">Generate</div>
            </div>
        </div>

        <!-- Step 1: Upload -->
        <div class="card" id="uploadCard">
            <div class="card-header">
                <div class="card-icon" style="background: rgba(6, 182, 212, 0.15); color: var(--accent-cyan);">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                </div>
                <div class="card-title">Upload n8n Workflow</div>
            </div>

            <div class="upload-zone" id="uploadZone">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <path d="M12 18v-6"/>
                    <path d="M9 15l3-3 3 3"/>
                </svg>
                <div class="upload-text">Drop your n8n workflow JSON here or click to browse</div>
                <div class="upload-hint">Supports Form Trigger workflows exported from n8n</div>
                <div class="file-info">
                    <span class="file-name" id="fileName"></span>
                </div>
            </div>
            <input type="file" id="fileInput" accept=".json" style="display: none;">
        </div>

        <!-- Step 2: Configure -->
        <div class="card hidden" id="configCard">
            <div class="card-header">
                <div class="card-icon" style="background: rgba(59, 130, 246, 0.15); color: var(--accent-primary);">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
                    </svg>
                </div>
                <div class="card-title">Configure Connector</div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Connector Name</label>
                    <input type="text" id="connectorName" placeholder="e.g., IP Geolocation">
                </div>
                <div class="form-group">
                    <label>Connector ID</label>
                    <input type="text" id="connectorId" placeholder="e.g., ip-geolocation">
                </div>
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea id="connectorDesc" placeholder="Brief description of what this connector does..."></textarea>
            </div>

            <div class="preview-section">
                <div class="preview-title">Detected from Workflow</div>
                <div class="preview-grid">
                    <div class="preview-box">
                        <div class="preview-box-title">Input Fields</div>
                        <div id="inputFields"></div>
                    </div>
                    <div class="preview-box">
                        <div class="preview-box-title">Output Fields</div>
                        <div id="outputFields"></div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="resetBuilder()">Start Over</button>
                <button class="btn btn-primary" onclick="generateConnector()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    Generate Connector
                </button>
            </div>
        </div>

        <!-- Step 3: Output -->
        <div class="card hidden" id="outputCard">
            <div class="card-header">
                <div class="card-icon" style="background: rgba(16, 185, 129, 0.15); color: var(--status-green);">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                </div>
                <div class="card-title">Connector Generated</div>
            </div>

            <div class="alert success">
                <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <div>
                    <strong>Success!</strong> Your connector files have been generated. Download them below.
                </div>
            </div>

            <ul class="file-list" id="fileList"></ul>

            <div class="alert info" style="margin-top: 1rem;">
                <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
                <div>
                    <strong>Next steps:</strong> Import the webhook workflow to n8n, copy the element template to your Camunda Modeler templates folder, and deploy the BPMN to Camunda.
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="resetBuilder()">Build Another</button>
                <button class="btn btn-success" onclick="downloadAll()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Download All
                </button>
            </div>
        </div>
        </div>

        <!-- Instructions Panel -->
        <div class="instructions-panel" id="instructionsPanel">
            <div class="instructions-header">
                <div class="instructions-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                    </svg>
                </div>
                <div class="instructions-title">Instructions</div>
            </div>

            <div id="instructionsContent">
                <!-- Step 1 Instructions -->
                <div class="instruction-section">
                    <div class="instruction-section-title">Build Your n8n Workflow</div>
                    <div class="instruction-content">
                        <ol>
                            <li>Open <strong>n8n</strong> (http://localhost:5678)</li>
                            <li>Create a new workflow with a <code>Form Trigger</code> node</li>
                            <li>Add form fields for your connector inputs</li>
                            <li>Build your integration logic (API calls, transformations)</li>
                            <li>Add a <code>Form</code> node with operation "Completion Page"</li>
                            <li>Test the form to ensure it works</li>
                            <li>Export the workflow as JSON</li>
                        </ol>
                        <div class="instruction-note">
                            <strong>Tip:</strong> Use descriptive field names. The builder will auto-detect them as connector inputs.
                        </div>
                    </div>
                </div>

                <div class="instruction-section">
                    <div class="instruction-section-title">Upload & Configure</div>
                    <div class="instruction-content">
                        <p>Once you have your working n8n workflow with Form Trigger:</p>
                        <ol>
                            <li>Upload the exported JSON file above</li>
                            <li>Review the detected input/output fields</li>
                            <li>Configure connector name and description</li>
                            <li>Click "Generate Connector"</li>
                        </ol>
                    </div>
                </div>

                <div class="instruction-section">
                    <div class="instruction-section-title">Deploy Generated Files</div>
                    <div class="instruction-content">
                        <p>The builder will generate 4 files:</p>
                        <ul>
                            <li><code>.n8n.json</code> - Webhook version for production</li>
                            <li><code>.element.json</code> - Camunda Modeler template</li>
                            <li><code>.bpmn</code> - Example BPMN process</li>
                            <li><code>README.md</code> - Documentation</li>
                        </ul>
                        <p style="margin-top: 0.75rem;"><strong>Next steps:</strong></p>
                        <ol>
                            <li>Import <code>.n8n.json</code> to n8n and activate it</li>
                            <li>Copy <code>.element.json</code> to Camunda Modeler templates folder</li>
                            <li>Save all files to <code>connectors/integrations/your-connector/</code></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let workflowData = null;
        let parsedData = null;
        let generatedFiles = {};

        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) handleFile(file);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            if (!file.name.endsWith('.json')) {
                alert('Please upload a JSON file');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    workflowData = JSON.parse(e.target.result);
                    parsedData = parseWorkflow(workflowData);

                    document.getElementById('fileName').textContent = file.name;
                    uploadZone.classList.add('has-file');

                    // Move to step 2
                    showConfigStep();
                } catch (err) {
                    alert('Invalid JSON file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        function parseWorkflow(workflow) {
            const result = {
                name: workflow.name || 'Unnamed Connector',
                inputs: [],
                outputs: [],
                webhookPath: ''
            };

            // Find Form Trigger node
            const formTrigger = workflow.nodes?.find(n =>
                n.type === 'n8n-nodes-base.formTrigger'
            );

            if (formTrigger) {
                // Extract inputs from form fields
                const formFields = formTrigger.parameters?.formFields?.values || [];
                result.inputs = formFields.map(f => ({
                    name: f.fieldName,
                    label: f.fieldLabel || f.fieldName,
                    required: f.requiredField !== false,
                    placeholder: f.placeholder || ''
                }));

                // Use form title as name
                if (formTrigger.parameters?.formTitle) {
                    result.name = formTrigger.parameters.formTitle;
                }
            }

            // Find outputs by scanning for $json references
            const jsonStr = JSON.stringify(workflow);
            const outputMatches = jsonStr.match(/\$json\.(\w+)/g) || [];
            const uniqueOutputs = [...new Set(outputMatches.map(m => m.replace('$json.', '')))];
            result.outputs = uniqueOutputs.filter(o =>
                !result.inputs.some(i => i.name === o)
            );

            // Generate webhook path from name
            result.webhookPath = 'catalyst-' + result.name.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');

            return result;
        }

        function showConfigStep() {
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');

            document.getElementById('uploadCard').classList.add('hidden');
            document.getElementById('configCard').classList.remove('hidden');

            // Pre-fill form
            document.getElementById('connectorName').value = parsedData.name;
            document.getElementById('connectorId').value = parsedData.name.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');

            // Show inputs
            const inputsDiv = document.getElementById('inputFields');
            if (parsedData.inputs.length > 0) {
                inputsDiv.innerHTML = parsedData.inputs.map(i =>
                    `<span class="tag ${i.required ? 'required' : ''}">${i.name}${i.required ? ' *' : ''}</span>`
                ).join('');
            } else {
                inputsDiv.innerHTML = '<span class="tag">No inputs detected</span>';
            }

            // Show outputs
            const outputsDiv = document.getElementById('outputFields');
            if (parsedData.outputs.length > 0) {
                outputsDiv.innerHTML = parsedData.outputs.map(o =>
                    `<span class="tag">${o}</span>`
                ).join('');
            } else {
                outputsDiv.innerHTML = '<span class="tag">Outputs from API response</span>';
            }
        }

        function generateConnector() {
            const name = document.getElementById('connectorName').value;
            const id = document.getElementById('connectorId').value;
            const desc = document.getElementById('connectorDesc').value;

            if (!name || !id) {
                alert('Please fill in the connector name and ID');
                return;
            }

            // Generate webhook version of n8n workflow
            generatedFiles[`${id}.n8n.json`] = generateWebhookWorkflow(workflowData, id);

            // Generate element template
            generatedFiles[`${id}.element.json`] = generateElementTemplate(name, id, desc, parsedData);

            // Generate BPMN
            generatedFiles[`${id}.bpmn`] = generateBpmn(name, id, parsedData);

            // Generate README
            generatedFiles['README.md'] = generateReadme(name, id, desc, parsedData);

            // Show output step
            showOutputStep();
        }

        function generateWebhookWorkflow(original, id) {
            // Build a clean webhook workflow from scratch
            const formTrigger = original.nodes?.find(n => n.type === 'n8n-nodes-base.formTrigger');
            const formTriggerName = formTrigger?.name || 'Form Trigger';

            // Find the middle nodes (not form trigger, not form completion)
            const middleNodes = original.nodes?.filter(n =>
                n.type !== 'n8n-nodes-base.formTrigger' &&
                !(n.type === 'n8n-nodes-base.form' && n.parameters?.operation === 'completion')
            ) || [];

            // Build new nodes array
            const newNodes = [];
            let xPos = 0;

            // 1. Webhook node (replaces Form Trigger)
            newNodes.push({
                parameters: {
                    httpMethod: 'POST',
                    path: 'catalyst-' + id,
                    responseMode: 'responseNode',
                    options: {}
                },
                type: 'n8n-nodes-base.webhook',
                typeVersion: 2.1,
                position: [xPos, 0],
                id: 'webhook-1',
                name: 'Webhook',
                webhookId: 'catalyst-' + id
            });
            xPos += 220;

            // 2. Middle nodes (update variable references from $json.var to $json.body.var)
            middleNodes.forEach((node, idx) => {
                // Deep clone the node to avoid mutating original
                const clonedNode = JSON.parse(JSON.stringify(node));

                // Transform all $json.variableName to $json.body.variableName
                // This handles webhook data structure where inputs are nested under body
                const nodeStr = JSON.stringify(clonedNode);
                const transformed = nodeStr.replace(/\$json\.(?!body\.)(\w+)/g, '$json.body.$1');
                const transformedNode = JSON.parse(transformed);

                newNodes.push({
                    ...transformedNode,
                    position: [xPos, 0],
                    id: transformedNode.id || `node-${idx + 2}`
                });
                xPos += 220;
            });

            // 3. Respond to Webhook node (replaces Form completion)
            newNodes.push({
                parameters: {
                    respondWith: 'json',
                    responseBody: '={{ { success: true, statusCode: 200, responseBody: $json, error: null } }}'
                },
                type: 'n8n-nodes-base.respondToWebhook',
                typeVersion: 1.1,
                position: [xPos, 0],
                id: 'respond-1',
                name: 'Respond to Webhook'
            });

            // Build connections: Webhook -> middle nodes -> Respond to Webhook
            const connections = {};
            const nodeNames = newNodes.map(n => n.name);

            for (let i = 0; i < nodeNames.length - 1; i++) {
                connections[nodeNames[i]] = {
                    main: [[{ node: nodeNames[i + 1], type: 'main', index: 0 }]]
                };
            }

            return JSON.stringify({
                name: original.name?.replace(' (Form)', '') || 'Webhook Workflow',
                nodes: newNodes,
                connections: connections,
                active: true,
                settings: { executionOrder: 'v1' },
                meta: { description: 'Production webhook version for Camunda integration.' }
            }, null, 2);
        }

        function generateElementTemplate(name, id, desc, parsed) {
            const template = {
                "$schema": "https://unpkg.com/@camunda/element-templates-json-schema/resources/schema.json",
                "name": `Catalyst - ${name}`,
                "id": `io.catalyst.template.${id}`,
                "description": desc || `${name} connector for Catalyst`,
                "version": 1,
                "appliesTo": ["bpmn:ServiceTask"],
                "icon": {
                    "contents": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%2306b6d4' stroke-width='2'%3E%3Cpath d='M12 2L2 7l10 5 10-5-10-5z'/%3E%3Cpath d='M2 17l10 5 10-5'/%3E%3Cpath d='M2 12l10 5 10-5'/%3E%3C/svg%3E"
                },
                "groups": [
                    { "id": "connection", "label": "Connection" },
                    { "id": "input", "label": "Input" },
                    { "id": "output", "label": "Output" }
                ],
                "properties": [
                    {
                        "label": "Implementation",
                        "type": "String",
                        "value": "io.catalyst.bridge.CatalystBridge",
                        "binding": { "type": "property", "name": "camunda:class" }
                    },
                    {
                        "label": "n8n Webhook URL",
                        "type": "String",
                        "value": `http://catalyst-n8n:5678/webhook/catalyst-${id}`,
                        "binding": { "type": "camunda:inputParameter", "name": "webhookUrl" },
                        "group": "connection",
                        "constraints": { "notEmpty": true }
                    },
                    {
                        "label": "Timeout (seconds)",
                        "type": "String",
                        "value": "30",
                        "binding": { "type": "camunda:inputParameter", "name": "timeout" },
                        "group": "connection"
                    }
                ]
            };

            // Add input fields
            parsed.inputs.forEach(input => {
                template.properties.push({
                    "label": input.label || input.name,
                    "description": input.placeholder ? `e.g., ${input.placeholder}` : '',
                    "type": "String",
                    "value": `\${${input.name}}`,
                    "binding": { "type": "camunda:inputParameter", "name": input.name },
                    "group": "input"
                });
            });

            // Add payload
            const payloadObj = {};
            parsed.inputs.forEach(i => payloadObj[i.name] = `\${${i.name}}`);
            template.properties.push({
                "label": "Payload",
                "type": "Text",
                "value": JSON.stringify(payloadObj, null, 2),
                "binding": { "type": "camunda:inputParameter", "name": "payload" },
                "group": "input"
            });

            // Add output mapping
            const outputMapping = {
                "success": "$.success",
                "statusCode": "$.statusCode",
                "error": "$.error"
            };
            parsed.outputs.forEach(o => outputMapping[o] = `$.responseBody.${o}`);
            template.properties.push({
                "label": "Output Mapping",
                "type": "Text",
                "value": JSON.stringify(outputMapping, null, 2),
                "binding": { "type": "camunda:inputParameter", "name": "outputMapping" },
                "group": "output"
            });

            return JSON.stringify(template, null, 2);
        }

        function generateBpmn(name, id, parsed) {
            const inputFields = parsed.inputs.map(i => `
          <camunda:formField id="${i.name}" label="${i.label || i.name}" type="string">
            <camunda:properties>
              <camunda:property id="description" value="${i.placeholder || ''}" />
            </camunda:properties>
          </camunda:formField>`).join('');

            const payloadObj = {};
            parsed.inputs.forEach(i => payloadObj[i.name] = `\${${i.name}}`);

            const outputMapping = { "success": "$.success", "statusCode": "$.statusCode", "error": "$.error" };
            parsed.outputs.forEach(o => outputMapping[o] = `$.responseBody.${o}`);

            return `<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_${id}" targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:process id="${id}-example" name="${name} Example" isExecutable="true" camunda:historyTimeToLive="P1D">
    <bpmn:startEvent id="StartEvent_1" name="Start">
      <bpmn:outgoing>Flow_1</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Activity_Input" />
    <bpmn:userTask id="Activity_Input" name="Enter Input" camunda:assignee="demo">
      <bpmn:extensionElements>
        <camunda:formData>${inputFields}
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1</bpmn:incoming>
      <bpmn:outgoing>Flow_2</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_2" sourceRef="Activity_Input" targetRef="Activity_Service" />
    <bpmn:serviceTask id="Activity_Service" name="${name}" camunda:modelerTemplate="io.catalyst.template.${id}" camunda:class="io.catalyst.bridge.CatalystBridge">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="webhookUrl">http://catalyst-n8n:5678/webhook/catalyst-${id}</camunda:inputParameter>
          <camunda:inputParameter name="timeout">30</camunda:inputParameter>
          <camunda:inputParameter name="payload">${JSON.stringify(payloadObj, null, 2)}</camunda:inputParameter>
          <camunda:inputParameter name="outputMapping">${JSON.stringify(outputMapping, null, 2)}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_2</bpmn:incoming>
      <bpmn:outgoing>Flow_3</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_3" sourceRef="Activity_Service" targetRef="EndEvent_1" />
    <bpmn:endEvent id="EndEvent_1" name="End">
      <bpmn:incoming>Flow_3</bpmn:incoming>
    </bpmn:endEvent>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="${id}-example">
      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="158" y="145" width="25" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_Input_di" bpmnElement="Activity_Input">
        <dc:Bounds x="240" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_Service_di" bpmnElement="Activity_Service">
        <dc:Bounds x="400" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1_di" bpmnElement="EndEvent_1">
        <dc:Bounds x="562" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="570" y="145" width="20" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">
        <di:waypoint x="188" y="120" />
        <di:waypoint x="240" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">
        <di:waypoint x="340" y="120" />
        <di:waypoint x="400" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_3_di" bpmnElement="Flow_3">
        <di:waypoint x="500" y="120" />
        <di:waypoint x="562" y="120" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>`;
        }

        function generateReadme(name, id, desc, parsed) {
            const inputTable = parsed.inputs.length > 0 ?
                parsed.inputs.map(i => `| \`${i.name}\` | String | ${i.required ? 'Yes' : 'No'} | ${i.label || i.name} |`).join('\n') :
                '| (none) | - | - | No input parameters |';

            const outputTable = parsed.outputs.length > 0 ?
                parsed.outputs.map(o => `| \`${o}\` | - | Response field |`).join('\n') :
                '| (from API) | - | See API documentation |';

            return `# Catalyst ${name} Connector

${desc || `${name} connector for Catalyst.`}

## Installation

### 1. Import n8n Workflow

1. Open your n8n instance
2. Click **Workflows** > **Import from File**
3. Select \`${id}.n8n.json\`
4. **Activate** the workflow

Webhook URL: \`http://catalyst-n8n:5678/webhook/catalyst-${id}\`

### 2. Deploy Element Template

Copy \`${id}.element.json\` to your Camunda Modeler templates directory.

## Input Parameters

| Variable | Type | Required | Description |
|----------|------|----------|-------------|
${inputTable}

## Output Variables

| Variable | Type | Description |
|----------|------|-------------|
| \`success\` | Boolean | Whether the request succeeded |
| \`statusCode\` | Number | HTTP status code |
${outputTable}
| \`error\` | String | Error message if failed |

## Files

- \`${id}.n8n.json\` - n8n webhook workflow
- \`${id}.element.json\` - Camunda Modeler template
- \`${id}.bpmn\` - Example BPMN process
- \`README.md\` - This documentation
`;
        }

        function showOutputStep() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.add('active');

            document.getElementById('configCard').classList.add('hidden');
            document.getElementById('outputCard').classList.remove('hidden');

            // Show file list
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = Object.entries(generatedFiles).map(([name, content]) => `
                <li class="file-item">
                    <div class="file-item-info">
                        <div class="file-item-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                        </div>
                        <div>
                            <div class="file-item-name">${name}</div>
                            <div class="file-item-size">${formatBytes(content.length)}</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="downloadFile('${name}')">Download</button>
                </li>
            `).join('');
        }

        function downloadFile(name) {
            const content = generatedFiles[name];
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadAll() {
            // Download each file with a small delay
            Object.keys(generatedFiles).forEach((name, i) => {
                setTimeout(() => downloadFile(name), i * 200);
            });
        }

        function resetBuilder() {
            workflowData = null;
            parsedData = null;
            generatedFiles = {};

            document.getElementById('step1').classList.add('active');
            document.getElementById('step1').classList.remove('completed');
            document.getElementById('step2').classList.remove('active', 'completed');
            document.getElementById('step3').classList.remove('active', 'completed');

            document.getElementById('uploadCard').classList.remove('hidden');
            document.getElementById('configCard').classList.add('hidden');
            document.getElementById('outputCard').classList.add('hidden');

            uploadZone.classList.remove('has-file');
            document.getElementById('fileName').textContent = '';
            document.getElementById('connectorName').value = '';
            document.getElementById('connectorId').value = '';
            document.getElementById('connectorDesc').value = '';
        }

        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            return (bytes / 1024).toFixed(1) + ' KB';
        }

        // ========================================
        // Animated Particles (from get-catalyst.dev)
        // ========================================
        class Particle {
            constructor(canvas, ctx) {
                this.canvas = canvas;
                this.ctx = ctx;
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;

                // Two velocity components: drift (constant, tiny) and velocity (dynamic, decays)
                this.drift = {
                    x: (Math.random() - 0.5) * 0.2,
                    y: (Math.random() - 0.5) * 0.2
                };
                this.velocity = {
                    x: 0,
                    y: 0
                };

                this.size = Math.random() * 3 + 1;
                this.type = Math.random() > 0.5 ? 'triangle' : 'circle';
                this.color = this.getRandomColor();
                this.angle = Math.random() * 360;
                this.spin = (Math.random() - 0.5) * 0.02;
                this.friction = 0.98; // Decays velocity by 2% per frame
            }

            getRandomColor() {
                const colors = [
                    'rgba(59, 130, 246, 0.5)',
                    'rgba(96, 165, 250, 0.5)',
                    'rgba(147, 51, 234, 0.3)',
                    'rgba(255, 255, 255, 0.1)'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            update(mouse) {
                // Apply interaction force
                const dx = mouse.x - this.x;
                const dy = mouse.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const maxDistance = 150;

                if (distance < maxDistance) {
                    const force = (maxDistance - distance) / maxDistance;
                    const forceDirectionX = dx / distance;
                    const forceDirectionY = dy / distance;

                    // Push away strongly
                    this.velocity.x -= forceDirectionX * force * 1.5;
                    this.velocity.y -= forceDirectionY * force * 1.5;
                }

                // Apply friction to dynamic velocity
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;

                // Update position (Drift + Dynamic Velocity)
                this.x += this.drift.x + this.velocity.x;
                this.y += this.drift.y + this.velocity.y;
                this.angle += this.spin;

                // Bounce off edges
                if (this.x < 0 || this.x > this.canvas.width) {
                    this.velocity.x *= -1; // Reflect dynamic velocity
                    this.drift.x *= -1;    // Reflect drift
                }
                if (this.y < 0 || this.y > this.canvas.height) {
                    this.velocity.y *= -1;
                    this.drift.y *= -1;
                }
            }

            draw() {
                this.ctx.save();
                this.ctx.translate(this.x, this.y);
                this.ctx.rotate(this.angle);
                this.ctx.fillStyle = this.color;

                if (this.type === 'triangle') {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, -this.size * 2);
                    this.ctx.lineTo(this.size, this.size);
                    this.ctx.lineTo(-this.size, this.size);
                    this.ctx.closePath();
                    this.ctx.fill();
                } else {
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                    this.ctx.fill();
                }

                this.ctx.restore();
            }
        }

        class ParticleNetwork {
            constructor() {
                this.canvas = document.getElementById('reactive-bg');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.numberOfParticles = 100;
                this.mouse = { x: -1000, y: -1000 }; // Initialize off-screen

                this.init();
                this.animate();

                window.addEventListener('resize', () => this.resize());
                window.addEventListener('mousemove', (e) => {
                    this.mouse.x = e.clientX;
                    this.mouse.y = e.clientY;
                });

                window.addEventListener('mouseout', () => {
                    this.mouse.x = -1000;
                    this.mouse.y = -1000;
                });
            }

            init() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.createParticles();
            }

            createParticles() {
                this.particles = [];
                const density = (this.canvas.width * this.canvas.height) / 15000;
                this.numberOfParticles = Math.min(density, 150);

                for (let i = 0; i < this.numberOfParticles; i++) {
                    this.particles.push(new Particle(this.canvas, this.ctx));
                }
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.createParticles();
            }

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                this.particles.forEach(particle => {
                    particle.update(this.mouse);
                    particle.draw();
                });

                this.connectParticles();

                requestAnimationFrame(this.animate.bind(this));
            }

            connectParticles() {
                const maxDistance = 150;
                for (let a = 0; a < this.particles.length; a++) {
                    for (let b = a; b < this.particles.length; b++) {
                        const dx = this.particles[a].x - this.particles[b].x;
                        const dy = this.particles[a].y - this.particles[b].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < maxDistance) {
                            const opacity = 1 - (distance / maxDistance);
                            this.ctx.strokeStyle = `rgba(59, 130, 246, ${opacity * 0.2})`;
                            this.ctx.lineWidth = 1;
                            this.ctx.beginPath();
                            this.ctx.moveTo(this.particles[a].x, this.particles[a].y);
                            this.ctx.lineTo(this.particles[b].x, this.particles[b].y);
                            this.ctx.stroke();
                        }
                    }
                }
            }
        }

        // Initialize particle network
        new ParticleNetwork();

        // Header navigation functions
        function openN8n() {
            window.open('http://localhost:5678', '_blank');
        }

        function openCamunda() {
            window.open('/camunda/app/cockpit/', '_blank');
        }

        // Service status checking
        async function checkServices() {
            // Check n8n
            try {
                const response = await fetch('/n8n/healthz', { mode: 'no-cors' });
                document.getElementById('n8nStatus').className = 'status-dot';
            } catch (e) {
                document.getElementById('n8nStatus').className = 'status-dot error';
            }

            // Check Camunda
            try {
                const response = await fetch('/camunda-api/version', { mode: 'no-cors' });
                document.getElementById('camundaStatus').className = 'status-dot';
            } catch (e) {
                document.getElementById('camundaStatus').className = 'status-dot error';
            }
        }

        // Check services on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkServices();
        });
    </script>
</body>

</html>
