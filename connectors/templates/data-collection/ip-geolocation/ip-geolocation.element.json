{
  "$schema": "https://unpkg.com/@camunda/element-templates-json-schema/resources/schema.json",
  "name": "Catalyst - IP Geolocation",
  "id": "io.catalyst.template.ip-geolocation",
  "description": "Look up geographic location data for any IP address using the ip-api.com service.",
  "version": 1,
  "appliesTo": ["bpmn:ServiceTask"],
  "icon": {
    "contents": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%2310b981' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='10' r='3'%3E%3C/circle%3E%3Cpath d='M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z'%3E%3C/path%3E%3C/svg%3E"
  },
  "groups": [
    {
      "id": "connection",
      "label": "Connection"
    },
    {
      "id": "input",
      "label": "Input"
    },
    {
      "id": "output",
      "label": "Output"
    }
  ],
  "properties": [
    {
      "label": "Implementation",
      "type": "String",
      "value": "io.catalyst.bridge.CatalystBridge",
      "binding": {
        "type": "property",
        "name": "camunda:class"
      }
    },
    {
      "label": "n8n Webhook URL",
      "description": "Full URL to your n8n IP Geolocation webhook",
      "type": "String",
      "value": "http://catalyst-n8n:5678/webhook/catalyst-ip-geolocation",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "webhookUrl"
      },
      "group": "connection",
      "constraints": {
        "notEmpty": true
      }
    },
    {
      "label": "Timeout (seconds)",
      "description": "Request timeout in seconds",
      "type": "String",
      "value": "30",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "timeout"
      },
      "group": "connection"
    },
    {
      "label": "IP Address",
      "description": "The IP address to look up. Leave blank to auto-detect caller's IP. Use ${variableName} to reference a process variable.",
      "type": "String",
      "value": "${ipAddress}",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "ipAddress"
      },
      "group": "input"
    },
    {
      "label": "Payload",
      "description": "Request payload sent to n8n (auto-generated from IP Address field)",
      "type": "Text",
      "value": "{\n  \"ipAddress\": \"${ipAddress}\"\n}",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "payload"
      },
      "group": "input"
    },
    {
      "label": "Output Mapping",
      "description": "Maps the API response to process variables",
      "type": "Text",
      "value": "{\n  \"success\": \"$.success\",\n  \"statusCode\": \"$.statusCode\",\n  \"country\": \"$.responseBody.country\",\n  \"countryCode\": \"$.responseBody.countryCode\",\n  \"region\": \"$.responseBody.regionName\",\n  \"city\": \"$.responseBody.city\",\n  \"zip\": \"$.responseBody.zip\",\n  \"lat\": \"$.responseBody.lat\",\n  \"lon\": \"$.responseBody.lon\",\n  \"timezone\": \"$.responseBody.timezone\",\n  \"isp\": \"$.responseBody.isp\",\n  \"org\": \"$.responseBody.org\",\n  \"error\": \"$.error\"\n}",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "outputMapping"
      },
      "group": "output"
    }
  ]
}
